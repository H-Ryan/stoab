/**
 * Created by Samuil on 11-09-2015.
 */
function switchFromTo(e,t){$(e).transition({animation:"vertical flip",duration:"500ms",onComplete:function(){$(t).transition({animation:"vertical flip",duration:"500ms"})}})}function convertTime(e){var t=["00","15","30","45"];return(e-e%4)/4+":"+t[e%4]}function tolkMoreInfo(e){var t=$(e.target).parents(".form");$.ajax({type:"GET",url:"src/misc/tolkMoreInfo.php",data:t.serialize(),cache:!0,dataType:"json",beforeSend:function(){$(e.target).addClass("loading")}}).done(function(t){if(0==t.error){var r=t.langs,n=$(".modal.tolkMoreInfoModal"),a=n.find(".content").find(".description").find(".tolkExtraInfo").find("tbody");a.empty(),$.each(r,function(){a.append("<tr><td>"+this.t_sprakName+"</td><td>"+this.t_rate+"</td><td>"+this.t_customerRate+"</td></tr>")}),n.modal("show")}$(e.target).removeClass("loading")})}function adjustTime(e,t,r,n){r.find("option").prop("disabled",!1),n.find("option").prop("disabled",!1),r.find("option").filter(function(t){return t<e.val()}).each(function(){$(this).prop("disabled",!0)}),e.val()===r.val()&&n.find("option").filter(function(e){return e<=t.val()}).each(function(){$(this).prop("disabled",!0)})}function getFullTolkningType(e){return"KT"==e?"Kontakttolkning":"TT"==e?"Telefontolkning":"KP"==e?"Kontaktperson":"SH"==e?"Studiehandledning":"Språkstöd"}function updateNewsletterEntries(){var e=$("#newsContainer"),t=e.children(".feed");return $.ajax({type:"GET",url:"src/misc/getAllNews.php",dataType:"json",beforeSend:function(){e.addClass("loading")}}).done(function(r){if(0===r.error)if(t.empty(),r.records.length>0)for(var n=0;n<r.records.length;n++){var a=$('<div class="event" style="border: solid 1px #d3d3d3; margin-bottom: 5px"></div>'),o=$('<form class="newsManageIDForm"></form>');o.append($('<input type="hidden" name="newsID"value="'+r.records[n].id+'"/>')),o.append($(' <div class="ui grid"> <div class="row"> <div class="column"> <div class="three ui vertical fluid inverted buttons"> <div class="mini ui blue inverted button btnNewsManageView">View </div> <div class="mini ui orange inverted button btnNewsManageEdit">Edit </div> <div class="mini ui red inverted button btnNewsManageDelete">Delete </div> </div> </div> </div> </div>'));var i=$('<div class="label"></div>');i.append($('<i class="mail outline icon"></i>')),i.append(o);var d=$('<div class="content"></div>'),s=$('<div class="summary"></div>');s.html(r.records[n].header);var l=$('<div class="extra text">'+r.records[n].prescript+"</div>");d.append(s),d.append(l),d.append($('<div class="meta"></div>')),a.append(i),a.append(d),t.append(a)}else e.append($("<div><p class='ui text'>Just nu har vi inte några nyheter!</p></div>"));e.removeClass("loading")}),!1}$(document).ready(function(){"use strict";var e=$(".ui.form.orderForm"),t=$(".ui.form.tolk-search"),r=$("#orderFilterForm"),n=$(".ui.basic.modal.modalResend"),a=$("#formSendToFinance"),o=$(".modal.emailResendResult");$(".ui.fluid.accordion").accordion(),$(".modal.order-history").on("click","#resendToTolk",function(){n.modal({closable:!1,onDeny:function(){return!0},onApprove:function(){$.ajax({type:"POST",url:"src/misc/resendTolkConfirm.php",data:a.serialize(),dataType:"json",beforeSend:function(){a.addClass("loading")}}).done(function(e){o.find(".content .description .header").text(0==e.error?"The email has been successfuly sent to the interpreter!":e.errorMessage),o.modal("show"),a.removeClass("loading")})}}),n.modal("show")}),$(".modal.order-history").on("click","#resendToClient",function(){n.modal({closable:!1,onDeny:function(){return!0},onApprove:function(){$.ajax({type:"POST",url:"src/misc/resendClientAboutTolkAssign.php",data:a.serialize(),dataType:"json",beforeSend:function(){$("#formSendToFinance").addClass("loading")}}).done(function(e){o.find(".content>.description>.header").text(0==e.error?"The email has been successfuly sent to the client!":e.errorMessage),o.modal("show"),a.removeClass("loading")})}}),n.modal("show")}),$(".left.sidebar").first().sidebar("attach events",".toggle.button").sidebar("setting","transition","slide along"),$("#btnSendToFinance").click(function(){return $.ajax({type:"POST",url:"src/misc/sendToFinance.php",data:$("#formSendToFinance").serialize(),dataType:"json",beforeSend:function(){$("#btnSendToFinance").addClass("loading")}}).done(function(e){var t=$(".modal.order-history"),r=t.find(".content .segment>.ui.positive.message"),n=t.find(".content .segment>.ui.error.message");0==e.error?(n.hide(),r.children("p").text(e.positiveMessage),r.children(".header").text(e.messageHeader),r.show()):(r.hide(),n.children("p").text(e.errorMessage),n.children(".header").text(e.messageHeader),n.show()),$("#btnSendToFinance").removeClass("loading")}),!1}),r.form({orderNumber:{identifier:"orderNumber",optional:!0,rules:[{type:"length[6]",prompt:"Ordernummer måste vara minst 6 tecken."},{type:"maxLength[6]",prompt:"Ordernummer måste vara minst 6 tecken."}]},tolkNumber:{identifier:"tolkNumber",optional:!0,rules:[{type:"length[4]",prompt:"Tolk nummer måste vara minst 4 tecken."},{type:"maxLength[4]",prompt:"Tolk nummer måste vara minst 4 tecken."},{type:"integer",prompt:"Tolk nummer innehåller ogiltiga tecken."}]},clientNumber:{identifier:"clientNumber",optional:!0,rules:[{type:"length[6]",prompt:"Kund nummer måste vara minst 6 tecken."},{type:"maxLength[6]",prompt:"Kund nummer måste vara minst 6 tecken."},{type:"integer",prompt:"Kund nummer innehåller ogiltiga tecken."}]}},{inline:!0,on:"change",transition:"slide down",onSuccess:function(){$.ajax({type:"POST",url:"src/misc/filterOrderHistory.php",data:r.filter(":visible").serialize(),cache:!1,dataType:"json",beforeSend:function(){$(".ui.dimmable .dimmer").dimmer("toggle")}}).done(function(e){if(r.form("reset"),r.get(0).reset(),0==e.error){var t=$(".orderHistory tbody");if(t.find("tr").remove(),$("#btnRemoveFilterHistory").removeClass("disabled"),e.orders.length>0){var n=$(".page-history");n.find("a").remove();for(var a=e.orders,o=e.customers,i=0;i<a.length;i++){var d="orange",s="Info",l=a[i].o_state;switch(l){case"O":s="Beställ in Progress",d="orange";break;case"B":s="Färdig",d="green";break;case"EC":s="Avbruten",d="red"}t.append("<tr><td>"+a[i].o_orderNumber+"</td><td>"+o[i].k_organizationName+"</td><td>"+a[i].o_orderer+"</td><td>"+a[i].o_language+"</td><td class='typeTip' data-content='"+getFullTolkningType(a[i].o_interpretationType)+"'>"+a[i].o_interpretationType+"</td><td>"+a[i].o_date+"</td><td>"+convertTime(a[i].o_startTime)+"</td><td>"+convertTime(a[i].o_endTime)+"</td><td><form class='ui form' id='"+a[i].o_orderNumber+"'><input type='hidden' name='orderId' value='"+a[i].o_orderNumber+"'><button type='button' class='ui "+d+" fluid button btn-info'>"+s+"</button></form></td></tr>"),$(".typeTip").popup()}var m=$(".modal.order-history");m.modal({closable:!1,onDeny:function(){return!1},onApprove:function(){var e=$(".modal.order-history");e.find(".content .segment>.ui.positive.message").hide(),e.find(".content .segment>.ui.error.message").hide()}}).modal("setting","transition","vertical flip"),$(".button.btn-info").on("click",function(){var e=$(this).parent("form").attr("id"),t=$(this);t.addClass("loading"),$.ajax({type:"POST",url:"../src/misc/orderMoreInfo.php",data:$("#"+e).serialize(),dataType:"json"}).done(function(e){if(0==e.error){m.find(".segment").first().find(".header span").text(e.order.o_orderNumber);var r=$(".orderExtra").find("tbody"),n=$(".tolkExtra").find("tbody");if(r.find("tr").remove(),n.find("tr").remove(),r.append("<tr><td>"+e.order.o_address+"</td><td>"+e.order.o_zipCode+"</td><td>"+e.order.o_city+"</td><td>"+e.order.o_client+"</td><td>"+e.order.o_comments+"</td></tr>"),n.append("<tr><td colspan='5'><div class='ui center aligned header'>Det finns ingen tolk tilldelats för denna ordning ännu.</div></td></tr>"),e.order.o_tolkarPersonalNumber){n.find("tr").remove(),n.append("<tr><td>"+e.tolk.u_firstName+" "+e.tolk.u_lastName+"</td><td>"+e.tolk.t_tolkNumber+"</td><td>"+e.tolk.u_tel+"</td><td>"+e.tolk.u_mobile+"</td><td>"+e.tolk.u_city+"</td></tr>");var a=$("#formSendToFinance");a.find("#orderNumber").val(e.order.o_orderNumber),a.find("#tolkNumber").val(e.order.o_tolkarPersonalNumber),$("#btnSendToFinance").removeClass("disabled")}else $("#btnSendToFinance").addClass("disabled");"B"!==e.order.o_state?($("#resendToTolk").addClass("disabled"),$("#resendToClient").addClass("disabled")):($("#resendToTolk").removeClass("disabled"),$("#resendToClient").removeClass("disabled")),m.modal("show")}t.removeClass("loading")})})}else t.append("<tr><td colspan='9'><div class='ui text'>Inga order matchar din sökning parametrar.</div></td></tr>");$(".ui.dimmable .dimmer").dimmer("toggle")}})}}),jQuery.validator.setDefaults({debug:!0,success:"valid"}),$("#btnRemoveFilterHistory").click(function(){$(".btn-update-history").trigger("click")}),$("#btnFilterHistory").click(function(){r.form("validate form")}),$("#newsPrescript").change(function(){var e=$(this).val().length,t=$("#chars");e>200?t.css("color","red"):t.css("color","black"),t.text(e)}),$(".typeTip").popup(),tinymce.init({selector:"#newsLetter, #newsLetterManage",plugins:["advlist autolink autoresize lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste emoticons"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | emoticons | link image media"});var i=$(".feed");i.on("click",".btnNewsManageView",function(){$("#newsLetterModifyForm").slideUp(500),$("#containerUpdateNews").addClass("basic");var e=$(this);return $.ajax({type:"GET",url:"src/misc/getNewsletterInfo.php",dataType:"json",beforeSend:function(){e.addClass("loading")},data:e.closest(".newsManageIDForm").serialize()}).done(function(t){0===t.error&&($(".modal.preview .header").html(t.header),$(".modal.preview #newsContent").html(t.content),$(".modal.preview").modal("show")),e.removeClass("loading")}),!1}),i.on("click",".btnNewsManageEdit",function(){var e=$(this),t=$("#containerUpdateNews");return $.ajax({type:"GET",url:"src/misc/getNewsletterInfo.php",dataType:"json",beforeSend:function(){e.addClass("loading"),t.addClass("loading")},data:e.closest(".newsManageIDForm").serialize()}).done(function(r){0===r.error&&($("#newsIdManage").val(r.id),$("#newsTitleManage").val(r.title.replace(/<(?:.|\n)*?>/gm,"")),$("#newsPrescriptManage").html(r.prescript.replace(/<(?:.|\n)*?>/gm,"")),tinyMCE.get("newsLetterManage").setContent(r.content),$("#newsLetterModifyForm").slideDown(500)),e.removeClass("loading"),t.removeClass("loading").removeClass("basic")}),!1}),i.on("click",".btnNewsManageDelete",function(){$("#newsLetterModifyForm").slideUp(500),$("#containerUpdateNews").addClass("basic");var e=$(".modal.newsManageDeleteAction"),t=e.find(".btnManageActionYes"),r=$(this).closest(".newsManageIDForm").children("[name='newsID']").val();t.data("id",r),e.modal("show")}),$("#btnPreviewNewsManage").on("click",function(){$(".modal.previewManage .header").text($("#newsTitleManage").val()+" - Publicerat: Idag"),$(".modal.previewManage #newsContent").html(tinyMCE.get("newsLetterManage").getContent()),$(".modal.previewManage").modal("show")}),$("#btnUpdateNewsLetterManage").on("click",function(){var e=$(".modal.newsManageUpdateAction");e.modal("show")}),$(".modal.newsManageUpdateAction .btnManageActionYes").on("click",function(){var e=$(this);return $.ajax({type:"POST",url:"src/misc/updateNews.php",dataType:"json",beforeSend:function(){e.addClass("loading")},data:{newsId:$("#newsIdManage").val(),newsTitle:$("#newsTitleManage").val(),newsPrescript:$("#newsPrescriptManage").val(),newsContent:tinyMCE.get("newsLetterManage").getContent()}}).done(function(t){0===t.error&&($("#newsLetterModifyForm").slideUp(500),$("#containerUpdateNews").addClass("basic"),e.removeClass("loading"),updateNewsletterEntries()),$(".small.news .content .description").text(t.message),$(".small.news").modal("show")}),!1}),$(".modal.newsManageDeleteAction .btnManageActionYes").on("click",function(){var e=$(this);return $.ajax({type:"POST",url:"src/misc/deleteNews.php",dataType:"json",beforeSend:function(){e.addClass("loading")},data:{newsID:e.data("id")}}).done(function(t){$(".small.news.modal .content .description").text(t.message),$(".small.news.modal").modal("show"),e.removeClass("loading"),updateNewsletterEntries()}),!1}),$("#btnPreviewNews").on("click",function(){$(".modal.preview .header").text($("#newsTitle").val()+" - Publicerat: Idag"),$(".modal.preview #newsContent").html(tinyMCE.get("newsLetter").getContent()),$(".modal.preview").modal("show")}),$("#btnPostNewsLetter").on("click",function(){return $.ajax({type:"POST",url:"src/misc/addNews.php",dataType:"json",beforeSend:function(){$("#btnPostNewsLetter").addClass("loading")},data:{newsTitle:$("#newsTitle").val(),newsPrescript:$("#newsPrescript").val(),newsContent:tinyMCE.get("newsLetter").getContent()}}).done(function(e){0===e.error&&($("#newsTitle").val(""),$("#newsPrescript").val(""),tinyMCE.get("newsLetter").setContent(""),updateNewsletterEntries()),$("#btnPostNewsLetter").removeClass("loading"),$(".small.news.modal .content .description").text(e.message),$(".small.news.modal").modal("show")}),!1});var d=$("#starttid"),s=$("#sluttid"),l=$("#starttid1"),m=$("#sluttid1");adjustTime(d,l,s,m),d.change(function(){adjustTime(d,l,s,m)}),s.change(function(){adjustTime(d,l,s,m)}),l.change(function(){adjustTime(d,l,s,m)}),m.change(function(){adjustTime(d,l,s,m)}),$(".ui.fluid.dropdown").dropdown(),$(".ui.search.dropdown").dropdown(),$(".logout-btn").click(function(){return $.ajax({type:"POST",url:"src/misc/logout.php"}).done(function(){window.location="index.php"}),!1}),$(".button.btn-info").on("click",function(){var e=$(".modal.order-history"),t=$(this).parent("form").attr("id"),r=$(this);r.addClass("loading"),$.ajax({type:"POST",url:"../src/misc/orderMoreInfo.php",data:$("#"+t).serialize(),dataType:"json"}).done(function(t){if(0==t.error){e.find(".segment").first().find(".header span").text(t.order.o_orderNumber);var n=$(".orderExtra").find("tbody"),a=$(".tolkExtra").find("tbody");if(n.find("tr").remove(),a.find("tr").remove(),n.append("<tr><td>"+t.order.o_address+"</td><td>"+t.order.o_zipCode+"</td><td>"+t.order.o_city+"</td><td>"+t.order.o_client+"</td><td>"+t.order.o_comments+"</td></tr>"),a.append("<tr><td colspan='5'><div class='ui center aligned header'>Det finns ingen tolk tilldelats för denna ordning ännu.</div></td></tr>"),"B"!==t.order.o_state?($("#resendToTolk").addClass("disabled"),$("#resendToClient").addClass("disabled")):($("#resendToTolk").removeClass("disabled"),$("#resendToClient").removeClass("disabled")),null!=t.order.o_tolkarPersonalNumber){a.find("tr").remove(),a.append("<tr><td>"+t.tolk.u_firstName+" "+t.tolk.u_lastName+"</td><td>"+t.tolk.t_tolkNumber+"</td><td>"+t.tolk.u_tel+"</td><td>"+t.tolk.u_mobile+"</td><td>"+t.tolk.u_city+"</td></tr>");var o=$("#formSendToFinance");o.find("#orderNumber").val(t.order.o_orderNumber),o.find("#tolkNumber").val(t.order.o_tolkarPersonalNumber),$("#btnSendToFinance").removeClass("disabled")}else $("#btnSendToFinance").addClass("disabled");e.modal("show")}r.removeClass("loading")})}),$("#date").datepicker({dateFormat:"yy-mm-dd",minDate:0}),$("#dateFilter").datepicker({dateFormat:"yy-mm-dd"}),$(".tolk-type").popup({inline:!0,transition:"scale"}),$(".radio.checkbox").checkbox(),$(".menu .item").tab(),$(".regOrganization").change(function(){var t=$(".regOrganization option:selected").text(),r=e.form("get value","regOrganization");return""!=r&&($("#organization").val(t),$.ajax({type:"POST",url:"src/misc/getOrgInfo.php",data:{branch_number:r},dataType:"json",beforeSend:function(){e.addClass("loading")}}).done(function(t){if(0==t.error){var r=t.orgInfo;"100000"!==r.k_kundNumber&&e.form("set values",{organizationNumber:r.k_personalNumber,clientNumber:r.k_kundNumber,contactPerson:r.k_firstName+" "+r.k_lastName,email:r.k_email,telephone:r.k_tel,mobile:r.k_mobile,address:r.k_address,post_code:r.k_zipCode,city:r.k_city})}e.removeClass("loading")})),!1}),$(".page-manage").on("click",".item",function(){var e="1";if($(this).hasClass("icon")){var t=$(".page-manage").find(".active.item");if($(this).hasClass("previousMPage")){var r=t.prevAll(".item").not(".previousMPage").first();!$.isEmptyObject(r)&&r.hasClass("item")?(t.removeClass("active"),r.addClass("active"),e=r.text()):e=t.text()}else if($(this).hasClass("nextMPage")){var n=t.nextAll(".item").not(".nextMPage").first();!$.isEmptyObject(n)&&n.hasClass("item")?(t.removeClass("active"),n.addClass("active"),e=n.text()):e=t.text()}}else $(this).addClass("active").closest(".ui.menu").find(".item").not($(this)).removeClass("active"),e=$(this).text();$("#updateCurrMPage").val(e),$.ajax({type:"GET",url:"src/misc/nextManagePage.php",data:{pageNum:e},cache:!0,dataType:"json",beforeSend:function(){$(".ui.dimmable .manageDim").dimmer("toggle")}}).done(function(e){if(0==e.error){var t=$(".orderManage tbody");if($(".orderManage").find("tbody").find("tr").remove(),e.orders.length>0)for(var r=e.orders,n=e.customers,a=0;a<r.length;a++){var o="orange",i="Info",d=r[a].o_state;switch(d){case"O":i="Beställ in Progress",o="orange";break;case"B":i="Färdig",o="green";break;case"EC":i="Avbruten",o="red"}t.append("<tr><td>"+r[a].o_orderNumber+"</td><td>"+n[a].k_organizationName+"</td><td>"+r[a].o_orderer+"</td><td>"+r[a].o_language+"</td><td class='typeTip' data-content='"+getFullTolkningType(r[a].o_interpretationType)+"'>"+r[a].o_interpretationType+"</td><td>"+r[a].o_date+"</td><td>"+convertTime(r[a].o_startTime)+"</td><td>"+convertTime(r[a].o_endTime)+"</td><td><form class='ui form' method='post' action='src/misc/orderInfo.php'><input type='hidden' name='orderId' value='"+r[a].o_orderNumber+"'><button type='submit' class='ui "+o+" fluid button btn_manage_order'>"+i+"</button></form></td></tr>"),$(".typeTip").popup()}else t.append("<tr><td><div class='ui text'>För närvarande, har du inte några order.</div></td></tr>");$(".ui.dimmable .manageDim").dimmer("toggle")}})}),$(".btn-update-manage").click(function(){$.ajax({type:"POST",url:"src/misc/currentOrders.php",data:$(".order_manage").serialize(),cache:!1,dataType:"json",beforeSend:function(){$(".ui.dimmable .manageDim").dimmer("toggle")}}).done(function(e){if(0==e.error){$.ajax({type:"GET",url:"src/misc/getCurrentOrOldOrderNum.php",data:{isManage:!0},cache:!0,dataType:"json"}).done(function(e){if(0==e.error){var t=e.numOfOrders;if(t>10){var r=$(".page-manage");r.find("a").remove(),r.append($('<a class="icon item"><i class="left arrow icon"></i></a>')),r.append($('<a class="active item" id="mpage1">1</a>'));var n=t%10;if(0===n)for(var a=t/10,o=2;a>=o;o++)r.append($('<a class="active item" id="mpage'+o+'">'+o+"</a>"));else for(var i=(t-n)/10+1,d=2;i>=d;d++)r.append($('<a class="active item" id="mpage'+d+'">'+d+"</a>"));r.append($('<a class="icon item"><i class="right arrow icon"></i></a>'))}}});var t=$(".orderManage tbody");if($(".orderManage").find("tbody").find("tr").remove(),e.orders.length>0)for(var r=e.orders,n=e.customers,a=0;a<r.length;a++){var o="orange",i="Info",d=r[a].o_state;switch(d){case"O":i="Beställ in Progress",o="orange";break;case"B":i="Färdig",o="green";break;case"EC":i="Avbruten",o="red"}t.append("<tr><td>"+r[a].o_orderNumber+"</td><td>"+n[a].k_organizationName+"</td><td>"+r[a].o_orderer+"</td><td>"+r[a].o_language+"</td><td class='typeTip' data-content='"+getFullTolkningType(r[a].o_interpretationType)+"'>"+r[a].o_interpretationType+"</td><td>"+r[a].o_date+"</td><td>"+convertTime(r[a].o_startTime)+"</td><td>"+convertTime(r[a].o_endTime)+"</td><td><form class='ui form' method='post' action='src/misc/orderInfo.php'><input type='hidden' name='orderId' value='"+r[a].o_orderNumber+"'><button type='submit' class='ui "+o+" fluid button btn_manage_order'>"+i+"</button></form></td></tr>"),$(".typeTip").popup()}else t.append("<tr><td><div class='ui text'>För närvarande, har du inte några order.</div></td></tr>");$(".ui.dimmable .manageDim").dimmer("toggle"),$(".button.btn-update-manage").prop("disabled",!0).addClass("disabled"),setTimeout(function(){var e=$(".button.btn-update-manage");e.prop("disabled",!1).removeClass("disabled")},3e3)}else{var s=$(".ui.error.message");$(".login-btn").parents(".login").removeClass("loading").addClass("error"),s.children("p").text("Error Message"),s.children(".header").text("Error")}})}),$(".page-history").on("click",".item",function(){var e="1";if($(this).hasClass("icon")){var t=$(".page-history").find(".active.item");if($(this).hasClass("previousHPage")){var r=t.prevAll(".item").not(".previousHPage").first();!$.isEmptyObject(r)&&r.hasClass("item")?(t.removeClass("active"),r.addClass("active"),e=r.text()):e=t.text()}else if($(this).hasClass("nextHPage")){var n=t.nextAll(".item").not(".nextHPage").first();!$.isEmptyObject(n)&&n.hasClass("item")?(t.removeClass("active"),n.addClass("active"),e=n.text()):e=t.text()}}else $(this).addClass("active").closest(".ui.menu").find(".item").not($(this)).removeClass("active"),e=$(this).text();$("#updateCurrHPage").val($(this).text()),$.ajax({type:"GET",url:"src/misc/nextHistoryPage.php",data:{pageNum:e},dataType:"json",cache:!0,beforeSend:function(){$(".ui.dimmable .dimmer").dimmer("toggle")}}).done(function(e){if(0==e.error){var t=$(".orderHistory tbody");if(t.find("tr").remove(),e.orders.length>0&&e.orders.length>0){for(var r=e.orders,n=e.customers,a=0;a<r.length;a++){var o="orange",i="Info",d=r[a].o_state;switch(d){case"O":i="Beställ in Progress",o="orange";break;case"B":i="Färdig",o="green";break;case"EC":i="Avbruten",o="red"}t.append("<tr><td>"+r[a].o_orderNumber+"</td><td>"+n[a].k_organizationName+"</td><td>"+r[a].o_orderer+"</td><td>"+r[a].o_language+"</td><td class='typeTip' data-content='"+getFullTolkningType(r[a].o_interpretationType)+"'>"+r[a].o_interpretationType+"</td><td>"+r[a].o_date+"</td><td>"+convertTime(r[a].o_startTime)+"</td><td>"+convertTime(r[a].o_endTime)+"</td><td><form class='ui form' id='"+r[a].o_orderNumber+"'><input type='hidden' name='orderId' value='"+r[a].o_orderNumber+"'><button type='button' class='ui "+o+" fluid button btn-info'>"+i+"</button></form></td></tr>"),$(".typeTip").popup()}var s=$(".modal.order-history");s.modal({closable:!1,onDeny:function(){return!1},onApprove:function(){var e=$(".modal.order-history");e.find(".content .segment>.ui.positive.message").hide(),e.find(".content .segment>.ui.error.message").hide()}}).modal("setting","transition","vertical flip"),$(".button.btn-info").on("click",function(){var e=$(this).parent("form").attr("id"),t=$(this);t.addClass("loading"),$.ajax({type:"POST",url:"../src/misc/orderMoreInfo.php",data:$("#"+e).serialize(),dataType:"json"}).done(function(e){if(0==e.error){s.find(".segment").first().find(".header span").text(e.order.o_orderNumber);var r=$(".orderExtra").find("tbody"),n=$(".tolkExtra").find("tbody");if(r.find("tr").remove(),n.find("tr").remove(),r.append("<tr><td>"+e.order.o_address+"</td><td>"+e.order.o_zipCode+"</td><td>"+e.order.o_city+"</td><td>"+e.order.o_client+"</td><td>"+e.order.o_comments+"</td></tr>"),n.append("<tr><td colspan='5'><div class='ui center aligned header'>Det finns ingen tolk tilldelats för denna ordning ännu.</div></td></tr>"),"B"!==e.order.o_state?($("#resendToTolk").addClass("disabled"),$("#resendToClient").addClass("disabled")):($("#resendToTolk").removeClass("disabled"),$("#resendToClient").removeClass("disabled")),null!=e.order.o_tolkarPersonalNumber){n.find("tr").remove(),n.append("<tr><td>"+e.tolk.u_firstName+" "+e.tolk.u_lastName+"</td><td>"+e.tolk.t_tolkNumber+"</td><td>"+e.tolk.u_tel+"</td><td>"+e.tolk.u_mobile+"</td><td>"+e.tolk.u_city+"</td></tr>");var a=$("#formSendToFinance");a.find("#orderNumber").val(e.order.o_orderNumber),a.find("#tolkNumber").val(e.order.o_tolkarPersonalNumber),$("#btnSendToFinance").removeClass("disabled")}else $("#btnSendToFinance").addClass("disabled");s.modal("show")}t.removeClass("loading")})})}else t.append("<tr><td><div class='ui text'>För närvarande, har du inte några order.</div></td></tr>");$(".ui.dimmable .dimmer").dimmer("toggle")}})}),$(".btn-update-history").click(function(){$.ajax({type:"POST",url:"src/misc/pastOrders.php",data:$(".order_history").serialize(),cache:!1,dataType:"json",beforeSend:function(){$(".ui.dimmable .dimmer").dimmer("toggle")}}).done(function(e){if(0==e.error){$("#btnRemoveFilterHistory").addClass("disabled"),$.ajax({type:"GET",url:"src/misc/getCurrentOrOldOrderNum.php",data:{isManage:!1},cache:!0,dataType:"json"}).done(function(e){if(0==e.error){var t=e.numOfOrders;if(t>10){var r=$(".page-history");r.find("a").remove(),r.append($('<a class="icon item"><i class="left arrow icon"></i></a>')),r.append($('<a class="active item" id="mpage1">1</a>'));var n=t%10;if(0===n)for(var a=t/10,o=2;a>=o;o++)r.append($('<a class="active item" id="mpage'+o+'">'+o+"</a>"));else for(var i=(t-n)/10+1,d=2;i>=d;d++)r.append($('<a class="active item" id="mpage'+d+'">'+d+"</a>"));r.append($('<a class="icon item"><i class="right arrow icon"></i></a>'))}}});var t=$(".orderHistory tbody");if(t.find("tr").remove(),e.orders.length>0){for(var r=e.orders,n=e.customers,a=0;a<r.length;a++){var o="orange",i="Info",d=r[a].o_state;switch(d){case"O":i="Beställ in Progress",o="orange";break;case"B":i="Färdig",o="green";break;case"EC":i="Avbruten",o="red"}t.append("<tr><td>"+r[a].o_orderNumber+"</td><td>"+n[a].k_organizationName+"</td><td>"+r[a].o_orderer+"</td><td>"+r[a].o_language+"</td><td class='typeTip' data-content='"+getFullTolkningType(r[a].o_interpretationType)+"'>"+r[a].o_interpretationType+"</td><td>"+r[a].o_date+"</td><td>"+convertTime(r[a].o_startTime)+"</td><td>"+convertTime(r[a].o_endTime)+"</td><td><form class='ui form' id='"+r[a].o_orderNumber+"'><input type='hidden' name='orderId' value='"+r[a].o_orderNumber+"'><button type='button' class='ui "+o+" fluid button btn-info'>"+i+"</button></form></td></tr>"),$(".typeTip").popup()}var s=$(".modal.order-history");s.modal({closable:!1,onDeny:function(){return!1},onApprove:function(){var e=$(".modal.order-history");e.find(".content .segment>.ui.positive.message").hide(),e.find(".content .segment>.ui.error.message").hide()}}).modal("setting","transition","vertical flip"),$(".button.btn-info").on("click",function(){var e=$(this).parent("form").attr("id"),t=$(this);t.addClass("loading"),$.ajax({type:"POST",url:"../src/misc/orderMoreInfo.php",data:$("#"+e).serialize(),dataType:"json"}).done(function(e){if(0==e.error){s.find(".segment").first().find(".header span").text(e.order.o_orderNumber);var r=$(".orderExtra").find("tbody"),n=$(".tolkExtra").find("tbody");if(r.find("tr").remove(),n.find("tr").remove(),r.append("<tr><td>"+e.order.o_address+"</td><td>"+e.order.o_zipCode+"</td><td>"+e.order.o_city+"</td><td>"+e.order.o_client+"</td><td>"+e.order.o_comments+"</td></tr>"),n.append("<tr><td colspan='5'><div class='ui center aligned header'>Det finns ingen tolk tilldelats för denna ordning ännu.</div></td></tr>"),"B"!==e.order.o_state?($("#resendToTolk").addClass("disabled"),$("#resendToClient").addClass("disabled")):($("#resendToTolk").removeClass("disabled"),$("#resendToClient").removeClass("disabled")),null!=e.order.o_tolkarPersonalNumber){n.find("tr").remove(),n.append("<tr><td>"+e.tolk.u_firstName+" "+e.tolk.u_lastName+"</td><td>"+e.tolk.t_tolkNumber+"</td><td>"+e.tolk.u_tel+"</td><td>"+e.tolk.u_mobile+"</td><td>"+e.tolk.u_city+"</td></tr>");var a=$("#formSendToFinance");a.find("#orderNumber").val(e.order.o_orderNumber),a.find("#tolkNumber").val(e.order.o_tolkarPersonalNumber),$("#btnSendToFinance").removeClass("disabled")}else $("#btnSendToFinance").addClass("disabled");s.modal("show")}t.removeClass("loading")})})}else t.append("<tr><td><div class='ui text'>För närvarande, har du inte några order.</div></td></tr>");$(".ui.dimmable .dimmer").dimmer("toggle"),$(".button.btn-update-history").prop("disabled",!0).addClass("disabled"),setTimeout(function(){var e=$(".btn-update-history");e.prop("disabled",!1).removeClass("disabled")},3e3)}})}),t.form({language:{identifier:"language",optional:!0,rules:[{type:"empty",prompt:"Välj ett av de språk från rullgardinsmenyn."}]}},{inline:!0,on:"blur",transition:"slide down",onSuccess:function(){$.ajax({type:"POST",url:"src/misc/searchTolks.php",data:t.filter(":visible").serialize(),cache:!1,dataType:"json",beforeSend:function(){$(".btnSearchTolk").addClass("loading")}}).done(function(e){var t=$(".searchTolkResult .tolks .tolksTable");if(t.find("tbody").empty(),0==e.error)if(e.tolks.length>0){for(var r=e.tolks,n=0;n<r.length;n++)t.find("tbody").append("<tr><td>"+r[n].t_tolkNumber+"</td><td>"+r[n].u_firstName+" "+r[n].u_lastName+"</td><td>"+r[n].u_state+"</td><td>"+r[n].u_city+"</td><td>"+r[n].t_gender+"</td><td>"+r[n].t_tolkNiva+"</td><td>"+r[n].t_rate+"</td><td>"+r[n].u_email+"</td><td>"+r[n].u_mobile+"</td><td><form class='ui form'><input type='hidden' name='tolkPN' value='"+r[n].u_personalNumber+"'><button type='button' onclick='tolkMoreInfo(event)' class='ui blue fluid button btnTolkInfo'>Mer Info</button></form></td></tr>");t.show()}else t.hide(),$(".searchTolkResult .tolks").append("<div class='ui segment'><div class='ui text'>För närvarande, har du inte några order.</div></div>");else{var a=$(".ui.error.message");$(".login-btn").parents(".login").removeClass("loading").addClass("error"),a.children("p").text("Error Message"),a.children(".header").text("Error")}$(".btnSearchTolk").removeClass("loading")})},onFailure:function(){t.removeClass("error").removeClass("transition").removeClass("visible")}}),$(".btnSearchTolk").click(function(){t.form("validate form"),t.form("clear"),t.get(0).reset()}),setInterval(function(){var e=t.form("get value","language");e?($(".searchCity").removeClass("disabled"),$(".searchState").removeClass("disabled")):($(".searchCity").addClass("disabled"),$(".searchState").addClass("disabled"))},500),e.validate({errorPlacement:function(e,t){e.appendTo("telephone"==t.attr("name")||"mobile"==t.attr("name")?t.closest(".fields"):t.closest(".field"))},ignore:":hidden:not(select)",errorElement:"div",errorClass:"error",validClass:"valid",onfocusout:function(e){this.element(e)},onkeyup:!1,highlight:function(e,t,r){$(e).closest(".field").addClass(t).removeClass(r)},unhighlight:function(e,t,r){$(e).closest(".field").addClass(r).removeClass(t)},groups:{phone_group:"telephone mobile"},rules:{client:{maxlength:90,minlength:3},language:{required:!0},type:{required:!0},tolk_type:{required:!0},date:{required:!0,date:!0},start_hour:{required:!0,digits:!0,range:[0,23]},start_minute:{required:!0,digits:!0},end_hour:{required:!0,digits:!0,range:[0,23]},end_minute:{required:!0,digits:!0},contactPerson:{required:!0,minlength:3,maxlength:90},organization:{required:!0,minlength:3,maxlength:60},email:{required:!0,maxlength:150,email:!0},telephone:{require_from_group:[1,".phone-group"],minlength:9,maxlength:11},mobile:{require_from_group:[1,".phone-group"],minlength:9,maxlength:11},address:{required:!0,maxlength:100,minlength:5},post_code:{required:!0,digits:!0,maxlength:5,minlength:5},city:{required:!0},message:{maxlength:255}},messages:{client:{maxlength:"Den kund området bör<br />innehålla mindre än {0} tecken.",minlength:"Den kund området bör<br />innehålla mer än {0} tecken."},date:{required:"Fältet Datum krävs.",date:"Fältet innehåller ogiltigt datum."},language:{required:"Välj ett av de språk från rullgardinsmenyn."},contactPerson:{required:"Fält Beställaren krävs.",maxlength:"Fält Beställaren bör<br />innehålla mindre än {0} tecken.",minlength:"Fält Beställaren bör<br />innehålla mer än {0} tecken."},organization:{required:"Fält Organisation krävs.",maxlength:"Fält Organisation bör<br />innehålla mindre än {0} tecken.",minlength:"Fält Organisation bör<br />innehålla mer än {0} tecken."},email:{required:"Fält e-postadress krävs.",email:"Den här e-post är inte giltig.",maxlength:"Fältet e-postadress ska<br />innehålla mindre än {0} tecken."},telephone:{regex:"Fält telefon är ogiltig.",maxlength:"Fältet Telefon bör<br />innehålla mindre än {0} tecken.",minlength:"Fältet Telefon bör<br />innehålla mer än {0} tecken."},mobile:{regex:"Fält Mobil är ogiltig.",maxlength:"Fältet Mobil bör<br />innehålla mindre än {0} tecken.",minlength:"Fältet Mobil bör<br />innehålla mer än {0} tecken."},address:{required:"Fält plats krävs.",maxlength:"Fält Plats bör<br />innehålla mindre än {0} tecken.",minlength:"Fält Plats bör<br />innehålla mer än {0} tecken."},post_code:{required:"Fält post nummer krävs.",digits:"Fält post nummer ska<br />endast innehålla siffror.",maxlength:"Fält Postnummer bör<br />innehålla mindre än {0} tecken.",minlength:"Fält Postnummer bör<br />innehålla mer än {0} tecken."},city:{required:"Välj en av städerna från rullgardinslistan."},message:{maxlength:"Fält plats bör<br />innehålla mindre än {0} tecken."},end_hour:{required:"Fel",digits:"Fel",range:"Fel"},end_minute:{required:"Fel",digits:"Fel"},start_hour:{required:"Fel",digits:"Fel",range:"Fel"},start_minute:{required:"Fel",digits:"Fel"}}}),jQuery.extend(jQuery.validator.messages,{require_from_group:"Fyll i minst ett av dessa områden."}),$(".orderForm input, .orderForm select").on("input",function(){$(this).valid()
}),$(".button.order-btn").click(function(){$(".button.order-btn").removeClass("disabled"),e.removeClass("error transition visible"),$.ajax({type:"POST",url:"../src/misc/orderRegular.php",data:e.serialize(),dataType:"json",beforeSend:function(){e.addClass("loading")}}).done(function(t){if(0==t.error)e.form("clear"),e.get(0).reset(),e.form("reset"),e.removeClass("loading"),switchFromTo(e.find("fieldset:visible"),e.find("fieldset").first());else{var r=$(".ui.error.message");e.removeClass("loading").addClass("error"),r.children("p").text("Error Message"),r.children(".header").text("Error")}})}),$(".button.next-btn").click(function(){e.validate(),e.valid()&&switchFromTo(e.find("fieldset:visible"),e.find("fieldset:visible").next())}),$(".button.back-btn").click(function(){switchFromTo(e.find("fieldset:visible"),e.find("fieldset:visible").prev())}),$(".page.dimmer").hide()});